<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <title>הזמנת מקום בפנסיון</title>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/616/616408.png" type="image/png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <link rel="stylesheet" href="css/common.css?v=50" />
  <link rel="stylesheet" href="css/order.css?v=50" />

</head>
<body>
  <div class="container">
    <div class="header">
      <h1><i class="fas fa-paw"></i> הזמנת מקום בפנסיון כלבים</h1>
      <div id="header-business-name" class="header-subtitle" style="font-size: 18px; color: rgba(255, 255, 255, 0.95); font-weight: 700; margin-bottom: 5px;">טוען נתונים...</div>
      <p>מלאו את הפרטים בשלושה שלבים פשוטים</p>
    </div>

    <div class="form-content">
      <div class="step-indicator">
        <div class="step active" data-step="0">
          <div class="step-circle">👤</div>
          <div class="step-label">זיהוי</div>
        </div>
        <div class="step" data-step="1">
          <div class="step-circle">1</div>
          <div class="step-label">פרטי הבעלים</div>
        </div>
        <div class="step" data-step="2">
          <div class="step-circle">2</div>
          <div class="step-label">פרטי הכלב</div>
        </div>
        <div class="step" data-step="3">
          <div class="step-circle">3</div>
          <div class="step-label">תאריכים</div>
        </div>
      </div>

      

      <form id="bookingForm" onsubmit="return false" autocomplete="off">
        <div class="form-step active" data-step="0">
          <div class="form-group">
            <label class="required">מספר טלפון</label>
            <input type="tel" id="identificationPhone" name="identificationPhone" placeholder="050-1234567" required autocomplete="off" />
            <div class="helper-text">הזן את מספר הטלפון שלך ולחץ על כפתור האישור</div>
          </div>
          <div class="button-group">
            <button type="button" class="btn-primary" onclick="identifyCustomer()">אישור והמשך ✓</button>
          </div>
          <div id="searchingIndicator" style="display: none; text-align: center; margin: 20px 0; color: #667eea; font-weight: 600;">
            <div style="display: inline-block; animation: spin 1s linear infinite;">⏳</div>
            מחפש הזמנות קודמות...
          </div>
          <div id="previousDogsContainer" style="display: none; margin-top: 20px;">
            <label class="required">מצאנו את הכלבים שלך! בחר כלב:</label>
            <div id="dogSelectionButtons" class="dog-selection-buttons"></div>
          </div>
        </div>

        <div class="form-step" data-step="1">
          <div class="form-group">
            <label class="required">שם מלא</label>
            <input type="text" name="ownerName" placeholder="לדוגמה: יוסי כהן" required />
          </div>
          <div class="button-group">
            <button type="button" class="btn-primary" onclick="nextStep()">המשך ←</button>
          </div>
        </div>

        <div class="form-step" data-step="2">
          <div class="form-group">
            <label class="required">שם הכלב</label>
            <input type="text" name="dogName" placeholder="לדוגמה: מקס" required />
          </div>
          <div class="form-group">
            <label class="required">גיל הכלב</label>
            <div class="radio-group radio-group-4">
              <label class="radio-option">
                <input type="radio" name="dogAge" value="גור (עד שנה)" required />
                <span class="radio-label">גור<br><small>עד שנה</small></span>
              </label>
              <label class="radio-option">
                <input type="radio" name="dogAge" value="צעיר (1-3)" required />
                <span class="radio-label">צעיר<br><small>1-3</small></span>
              </label>
              <label class="radio-option">
                <input type="radio" name="dogAge" value="בוגר (4-7)" required />
                <span class="radio-label">בוגר<br><small>4-7</small></span>
              </label>
              <label class="radio-option">
                <input type="radio" name="dogAge" value="מבוגר (8+)" required />
                <span class="radio-label">מבוגר<br><small>8+</small></span>
              </label>
            </div>
          </div>
          <div class="form-group">
            <label class="required">גודל הכלב</label>
            <div class="radio-group radio-group-3">
              <label class="radio-option">
                <input type="radio" name="dogSize" value="קטן" required />
                <span class="radio-label">קטן<br><small>עד 10 ק"ג</small></span>
              </label>
              <label class="radio-option">
                <input type="radio" name="dogSize" value="בינוני" required />
                <span class="radio-label">בינוני<br><small>10-25 ק"ג</small></span>
              </label>
              <label class="radio-option">
                <input type="radio" name="dogSize" value="גדול" required />
                <span class="radio-label">גדול<br><small>מעל 25 ק"ג</small></span>
              </label>
            </div>
          </div>
          <div class="form-group">
            <label class="required">מין וסירוס/עיקור</label>
            <div class="radio-group radio-group-neuter">
              <label class="radio-option">
                <input type="radio" name="neutered" value="מסורס" required />
                <span class="radio-label">מסורס<br><small>(זכר)</small></span>
              </label>
              <label class="radio-option">
                <input type="radio" name="neutered" value="מעוקרת" required />
                <span class="radio-label">מעוקרת<br><small>(נקבה)</small></span>
              </label>
              <label class="radio-option">
                <input type="radio" name="neutered" value="לא מסורס" required />
                <span class="radio-label">לא מסורס<br><small>(זכר)</small></span>
              </label>
              <label class="radio-option">
                <input type="radio" name="neutered" value="לא מעוקרת" required />
                <span class="radio-label">לא מעוקרת<br><small>(נקבה)</small></span>
              </label>
            </div>
          </div>
          <div class="form-group">
            <label>הערות מיוחדות</label>
            <textarea name="notes" placeholder="אלרגיות, תרופות, התנהגות מיוחדת וכו'"></textarea>
          </div>
          <div class="button-group">
            <button type="button" class="btn-secondary" onclick="prevStep()">חזרה →</button>
            <button type="button" class="btn-primary" onclick="nextStep()">המשך ←</button>
          </div>
        </div>

        <div class="form-step" data-step="3">
          <div class="date-group">
            <div class="form-group">
              <label class="required">תאריך כניסה</label>
              <input type="date" name="checkIn" id="checkInDate" required />
            </div>
            <div class="form-group">
              <label class="required">תאריך יציאה</label>
              <input type="date" name="checkOut" id="checkOutDate" required />
            </div>
          </div>
          
          <div id="daysDisplay" class="days-display">
            <span id="daysText"></span>
          </div>
          
          <div class="helper-text" style="margin-top: 8px;">
            * היציאה עד השעה 18:00
          </div>

          <div id="summaryPreview"></div>

          <div class="button-group">
            <button type="button" class="btn-secondary" onclick="prevStep()">חזרה →</button>
            <button type="button" class="btn-primary" onclick="submitForm()">שלח הזמנה ✓</button>
          </div>
          <div class="form-group" style="margin-top:24px; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
              <button type="button" id="prevMonthBtn" onclick="changeCapacityMonth(-1)" style="background:none; border:none; font-size:20px; cursor:pointer; color:#667eea; padding: 5px;"><i class="fas fa-chevron-right"></i></button>
              <div id="capacityPicker" style="display: flex; gap: 4px; align-items: center; color: #667eea; font-weight: 700;">
                <select id="capacityMonth" onchange="jumpCapacityToDate()" style="border: none; background: transparent; font-size: 18px; font-weight: 700; color: #667eea; cursor: pointer; padding: 2px; outline: none; font-family: inherit;">
                  <option value="0">ינואר</option>
                  <option value="1">פברואר</option>
                  <option value="2">מרץ</option>
                  <option value="3">אפריל</option>
                  <option value="4">מאי</option>
                  <option value="5">יוני</option>
                  <option value="6">יולי</option>
                  <option value="7">אוגוסט</option>
                  <option value="8">ספטמבר</option>
                  <option value="9">אוקטובר</option>
                  <option value="10">נובמבר</option>
                  <option value="11">דצמבר</option>
                </select>
                <select id="capacityYear" onchange="jumpCapacityToDate()" style="border: none; background: transparent; font-size: 18px; font-weight: 700; color: #667eea; cursor: pointer; padding: 2px; outline: none; font-family: inherit;">
                </select>
              </div>
              <button type="button" id="nextMonthBtn" onclick="changeCapacityMonth(1)" style="background:none; border:none; font-size:20px; cursor:pointer; color:#667eea; padding: 5px;"><i class="fas fa-chevron-left"></i></button>
            </div>
            
            <div style="display:grid; grid-template-columns: repeat(7, 1fr); gap:4px; text-align:center; font-weight:bold; margin-bottom:8px; font-size:12px; color:#555;">
              <div>א'</div><div>ב'</div><div>ג'</div><div>ד'</div><div>ה'</div><div>ו'</div><div>ש'</div>
            </div>
            <div id="capacityCalendar" style="display:grid; grid-template-columns: repeat(7, 1fr); gap:6px;"></div>
            
            <div style="display:flex; gap:10px; justify-content:center; margin-top:12px; font-size:11px; color:#555;">
              <div style="display:flex; align-items:center; gap:4px;"><span style="width:10px; height:10px; background:#4caf50; border-radius:50%;"></span> פנוי</div>
              <div style="display:flex; align-items:center; gap:4px;"><span style="width:10px; height:10px; background:#ff9800; border-radius:50%;"></span> כמעט מלא</div>
              <div style="display:flex; align-items:center; gap:4px;"><span style="width:10px; height:10px; background:#f44336; border-radius:50%;"></span> מלא</div>
            </div>
          </div>

        </div>

        <div class="form-step" data-step="4">
          <div class="success-message">
            <div class="success-icon">✓</div>
            <h2>ההזמנה נשלחה בהצלחה!</h2>
            <p>תקבלו אישור בווטסאפ בהקדם.<br>מספר הטלפון שלנו: <span id="displayAdminPhone">052-8366744</span></p>
            <div id="finalSummary"></div>
            <button type="button" class="btn-primary" onclick="resetForm()" style="margin-top: 24px;">הזמנה חדשה</button>
          </div>
        </div>
      </form>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/config.js?v=50"></script>
  <script src="js/auth.js?v=50"></script>
  <script src="js/utils.js?v=50"></script>
  <script src="js/order.js?v=50"></script>
</body>
</html>